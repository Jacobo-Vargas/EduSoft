<div class="fondo">
  <div class="container py-5">
    <div class="shadowbox mx-auto">
      <h1 class="text-center mb-2">Cambiar contraseña</h1>
      <p class="text-center mb-4 text-muted">
        La contraseña debe tener al menos 8 caracteres, incluyendo una letra mayúscula, una minúscula, un número y un
        carácter especial.
      </p>

      <!-- Alertas -->
      <div *ngIf="errorMsg" class="alert alert-danger mb-3">{{ errorMsg }}</div>
      <div *ngIf="showSuccessMessage" class="alert alert-success mb-3">
        ✅ La contraseña se ha modificado correctamente
      </div>

      <form class="row g-3" [formGroup]="userForm" (ngSubmit)="onSubmit()" novalidate autocomplete="off">
        <!-- Contraseña nueva -->
        <div class="mb-2 row align-items-center">
          <label for="Password1" class="col-sm-3 col-form-label">Nueva contraseña</label>
          <div class="col-sm-9">
            <div class="input-group">
              <input id="Password1" [type]="showPassword1 ? 'text' : 'password'" class="form-control"
                formControlName="Password1" placeholder="Ingresar nueva contraseña"
                [class.is-invalid]="f['Password1']?.touched && f['Password1']?.invalid" />
              <button type="button" class="btn btn-outline-secondary" (click)="togglePassword1()" tabindex="-1">
                <i class="bi" [ngClass]="showPassword1 ? 'bi-eye-slash' : 'bi-eye'"></i>
              </button>
              <div class="invalid-feedback" *ngIf="f['Password1']?.errors?.['required']">
                La contraseña es obligatoria.
              </div>
              <div class="invalid-feedback" *ngIf="f['Password1']?.errors?.['minlength']">
                Debe tener mínimo 8 caracteres.
              </div>
              <div class="invalid-feedback" *ngIf="f['Password1']?.errors?.['pattern']">
                Debe contener al menos una mayúscula, una minúscula, un número y un carácter especial.
              </div>
            </div>
          </div>
        </div>

        <!-- Confirmar contraseña -->
        <div class="mb-2 row align-items-center">
          <label for="Password2" class="col-sm-3 col-form-label">Confirmar contraseña</label>
          <div class="col-sm-9">
            <div class="input-group">
              <input id="Password2" [type]="showPassword2 ? 'text' : 'password'" class="form-control"
                formControlName="Password2" placeholder="Confirmar contraseña"
                [class.is-invalid]="f['Password2']?.touched && f['Password2']?.invalid" />
              <button type="button" class="btn btn-outline-secondary" (click)="togglePassword2()" tabindex="-1">
                <i class="bi" [ngClass]="showPassword2 ? 'bi-eye-slash' : 'bi-eye'"></i>
              </button>
              <div class="invalid-feedback" *ngIf="f['Password2']?.errors?.['required']">
                Confirmar la contraseña es obligatorio.
              </div>
              <div class="invalid-feedback" *ngIf="f['Password2']?.errors?.['mismatch']">
                Las contraseñas no coinciden.
              </div>
            </div>
          </div>
        </div>


        <!-- Acciones -->
        <div class="col-12 text-center mt-3">
          <button type="button" class="btn btn-outline-secondary me-2" (click)="onReset()" [disabled]="isLoading">
            Limpiar
          </button>

          <button type="submit" class="btn btn-success" [disabled]="isLoading || userForm.invalid">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"
              aria-hidden="true"></span>
            Cambiar contraseña
          </button>
        </div>
      </form>
    </div>
  </div>
</div>